name: Build and Deploy
on:
  push:
    branches: [main, master]

jobs:
  deploy:
    runs-on: windows-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup NuGet
        uses: NuGet/setup-nuget@v2

      - name: Restore packages
        run: nuget restore PartsUnlimited.sln

      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v2

      # Build step
      - name: Build
        shell: pwsh
        run: |
          msbuild src\PartsUnlimitedWebsite\PartsUnlimitedWebsite.csproj `
            /p:Configuration=Release `
            /p:Platform=AnyCPU `
            /p:DeployOnBuild=true `
            /p:WebPublishMethod=FileSystem `
            /p:PublishUrl="..\..\artifact" `
            /p:DeployTarget=WebPublish

      # Deploy step - NO IIS MODULES
      - name: Copy to IIS Path
        shell: pwsh
        run: |
          $sitePath = "D:\inetpub\wwwroot\partsUnlimited"
          
          Write-Host "Copying files to: $sitePath"
          
          # Create directory if needed
          if (!(Test-Path $sitePath)) {
              New-Item -ItemType Directory -Path $sitePath -Force
          }
          
          # Simple file copy
          Copy-Item -Path ".\artifact\*" -Destination $sitePath -Recurse -Force
          
          Write-Host "‚úÖ Deployment complete"
          Write-Host "üåê http://localhost:8089"
