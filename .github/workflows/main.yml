name: Deploy to IIS
on:
  push:
    branches: [main, master]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: self-hosted
    if: github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master')
    
    steps:
      # Download build artifacts
      - name: Download build artifacts
        uses: actions/download-artifact@v4
        with:
          name: PartsUnlimited-Web
          path: ./artifacts
      
      # Simple file copy to IIS path
      - name: Copy to IIS Path
        shell: powershell
        run: |
          $sitePath = "C:\inetpub\wwwroot\PartsUnlimited"
          
          Write-Host "Copying artifacts to IIS path..."
          Write-Host "From: .\artifacts"
          Write-Host "To: $sitePath"
          
          # Ensure directory exists
          if (!(Test-Path $sitePath)) {
              New-Item -ItemType Directory -Path $sitePath -Force
          }
          
          # Simple copy - overwrite existing files
          Copy-Item -Path ".\artifacts\*" -Destination $sitePath -Recurse -Force
          
          Write-Host "âœ… Files copied successfully"
